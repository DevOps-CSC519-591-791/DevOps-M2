# DevOps-M2
It's repo for DevOps Milestone 2.
We use [solar-calc](https://github.ncsu.edu/DevOps-Milestones/solar-calc) as our open-source project. It is a sunrise and sunset calculator for npm based on the NOAA Solar Calculator.

### Prerequisite
At very beginning, you need to clone the repository and install the necessary packages.
Here are commands.
```
git clone https://github.ncsu.edu/DevOps-Milestones/solar-calc
sudo npm install
```

### Test Section
#### Test Suites: `The ability to run unit tests, measure coverage, and report the results`
Solar-calc has its own test suite, which locates in `test/test.js` file. Solar-calc uses `mocha` javascript test framework. And we combined `mocha` and `istanbul`. So you can run the original test suite and see the coverage information by typing the command below.
```
npm run test
```

The results are show below:
```
  suncalc
    2015-03-08 in North Carolina
      ✓ get solar noon
      ✓ get golden hour start
      ✓ get golden hour end
      ✓ get night end
      ✓ get nautical dawn
      ✓ get dawn
      ✓ get sunrise
      ✓ get sunriseEnd
      ✓ get sunsetStart
      ✓ get sunset
      ✓ get dusk
      ✓ get nautical dusk
      ✓ get night start
      ✓ should get moon illuminosity
      ✓ should get moon distance
    2015-06-23 in extreme latitude
      ✓ get solar noon
      ✓ get golden hour start
      ✓ get golden hour end
      ✓ get night end
      ✓ get nautical dawn
      ✓ get dawn
      ✓ get sunrise
      ✓ get sunriseEnd
      ✓ get sunsetStart
      ✓ get sunset
      ✓ get dusk
      ✓ get nautical dusk
      ✓ get night start
      ✓ should get moon illuminosity
      ✓ should get moon distance

  30 passing (209ms)

=============================== Coverage summary ===============================
Statements   : 95.47% ( 358/375 )
Branches     : 70.24% ( 59/84 )
Functions    : 100% ( 74/74 )
Lines        : 97.21% ( 314/323 )
================================================================================
```
As you can see the statement coverage is already very high. However, if you try to open the reports automatically generated by istanbul by typing the command below, you will see some lines are still not covered. 
```
open coverage/lcov-report/solar-calc/lib/index.html
```

#### Advanced Testing: `Fuzz testing sun.js`
Although we've tested the project in step 1, we found that in `sun.js`, some statements and branches are not covered.  
Consequently, we applied the fuzz testing to `sun.js`. The test cases were added into the original test suite which we used in step 1. Scripts of fuzz testing is in [test/fuzz.js](https://github.ncsu.edu/DevOps-Milestones/solar-calc/blob/master/test/fuzz.js).

To run fuzz testing, you need to type the command below.
```
npm run fuzz
```

Coverage report before we applied fuzz testing can be found [here](https://github.ncsu.edu/DevOps-Milestones/DevOps-M2/blob/master/sun1.pdf).  
After the fuzz testing, we got a better coverage, see [here] (https://github.ncsu.edu/DevOps-Milestones/DevOps-M2/blob/master/sun2.pdf).

![](https://github.ncsu.edu/DevOps-Milestones/DevOps-M2/blob/master/sun_fuzz.png)  
(up: original test suite ouput; down: coverage comparison before and after the fuzz testing)

The following figure shows the coverage status from Line 44 through line 88 before and after the fuzz testing.
![](https://github.ncsu.edu/DevOps-Milestones/DevOps-M2/blob/master/sun_detail.png)  
(left: test suite ouput before fuzz testing; right: test suite output after fuzz testing)
